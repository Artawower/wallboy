#+TITLE: Wallboy
#+AUTHOR: darkawower
#+DESCRIPTION: CLI wallpaper manager for macOS
#+html: <img src="./images/wallboy.webp" align="right" width="25%">

A CLI utility for managing desktop wallpapers on macOS.

Supports local and remote image sources with automatic light/dark theme detection.


Features

- Automatic theme detection (light/dark) from macOS system settings
- Local and remote image sources
- Providers: Unsplash, Wallhaven, Generic URL
- Temporary downloads for preview, save what you like
- Dominant color analysis (k-means clustering)
- Modern CLI with colored output
- Cross-platform architecture (macOS primary, Linux/Windows support)

** Installation

#+begin_src bash
go install github.com/darkawower/wallboy/cmd/wallboy@latest
#+end_src

Or build from source:

#+begin_src bash
git clone https://github.com/darkawower/wallboy
cd wallboy
go build -o wallboy ./cmd/wallboy
#+end_src

** Quick Start

#+begin_src bash
# Initialize config and directories
wallboy init

# Set a random wallpaper
wallboy next

# Save the current wallpaper if you like it
wallboy save

# Show current wallpaper info
wallboy info

# Show dominant colors
wallboy colors
#+end_src

** Commands

| Command                  | Description                                |
|--------------------------+--------------------------------------------|
| =wallboy init=           | Initialize config and directories          |
| =wallboy next=           | Set a random wallpaper                     |
| =wallboy save=           | Save current wallpaper (from temp to saved)|
| =wallboy info=           | Show current wallpaper information         |
| =wallboy show=           | Open wallpaper in default image viewer     |
| =wallboy open=           | Reveal wallpaper in Finder                 |
| =wallboy colors=         | Show dominant colors                       |
| =wallboy delete=         | Delete current wallpaper and set new one   |
| =wallboy sources=        | List all configured datasources            |
| =wallboy agent-install=  | Install auto-rotation agent                |
| =wallboy agent-status=   | Show agent status                          |
| =wallboy agent-uninstall=| Uninstall auto-rotation agent              |
| =wallboy version=        | Show version                               |

** Flags

| Flag            | Description                          |
|-----------------+--------------------------------------|
| =--config=      | Path to config file                  |
| =--theme=       | Override theme (auto/light/dark)     |
| =--source=      | Use specific datasource              |
| =--dry-run=     | Show what would be done              |
| =-v, --verbose= | Verbose output                       |
| =-q, --quiet=   | Minimal output                       |

** Workflow

#+begin_src
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  wallboy next                                               │
│       │                                                     │
│       ▼                                                     │
│  ┌─────────────┐     ┌─────────────┐                        │
│  │ Local       │ or  │ Remote      │                        │
│  │ Datasource  │     │ Datasource  │                        │
│  └──────┬──────┘     └──────┬──────┘                        │
│         │                   │                               │
│         │                   ▼                               │
│         │           Download to temp/                       │
│         │                   │                               │
│         ▼                   ▼                               │
│     Set as wallpaper ◄──────┘                               │
│         │                                                   │
│         ▼                                                   │
│  ┌─────────────────────────────────────┐                    │
│  │ Like it?                            │                    │
│  │                                     │                    │
│  │  wallboy save   → saved/            │                    │
│  │  wallboy next   → delete, get next  │                    │
│  │  wallboy delete → delete, get next  │                    │
│  └─────────────────────────────────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
#+end_src

** Configuration

Configuration is stored in =~/.config/wallboy/config.toml=

*** Minimal Config

#+begin_src toml
[theme]
mode = "auto"  # auto | light | dark

[providers.local]
recursive = true

[light]
dirs = ["~/Pictures/Wallpapers/Light"]

[dark]
dirs = ["~/Pictures/Wallpapers/Dark"]
#+end_src

*** Full Config Example

#+begin_src toml
[state]
path = "~/.config/wallboy/state.json"

[theme]
mode = "auto"  # auto | light | dark

# Provider credentials (configured once, used by all themes)
[providers.wallhaven]
auth = "${WALLHAVEN_API_KEY}"

[providers.unsplash]
auth = "${UNSPLASH_ACCESS_KEY}"

[providers.local]
recursive = true  # scan subdirectories

# Light theme
[light]
dirs = ["~/Pictures/Wallpapers/Light"]
upload-dir = "~/Pictures/Wallpapers/Light"
queries = ["nature", "minimal", "bright", "white art"]
providers = ["wallhaven", "unsplash"]  # optional: limit to specific providers

# Dark theme
[dark]
dirs = ["~/Pictures/Wallpapers/Dark"]
upload-dir = "~/Pictures/Wallpapers/Dark"
queries = ["night city", "cyberpunk", "neon", "space", "dark minimal"]
# providers omitted = use all configured providers
#+end_src

*** Config Structure

| Section              | Description                                      |
|----------------------+--------------------------------------------------|
| =[state]=            | State file path                                  |
| =[theme]=            | Theme mode: auto, light, or dark                 |
| =[providers.*]=      | Provider credentials (wallhaven, unsplash, local)|
| =[light]= / =[dark]= | Theme-specific settings                          |

*** Theme Settings

| Field        | Description                                          |
|--------------+------------------------------------------------------|
| =dirs=       | Array of local directories to scan for images        |
| =upload-dir= | Where to save images from remote providers           |
| =queries=    | Search queries for remote providers                  |
| =providers=  | (Optional) Limit to specific providers               |

** Providers

*** Local Provider

Scans local directories for images.

#+begin_src toml
[providers.local]
recursive = true  # scan subdirectories (default: true)
#+end_src

Supported formats: =jpg=, =jpeg=, =png=, =webp=

*** Wallhaven

[[https://wallhaven.cc][Wallhaven]] is a popular wallpaper service with a large collection.

1. Get your API key: https://wallhaven.cc/settings/account
2. Export the key:
   #+begin_src bash
   export WALLHAVEN_API_KEY="your_key_here"
   #+end_src
3. Add to config:

#+begin_src toml
[providers.wallhaven]
auth = "${WALLHAVEN_API_KEY}"
#+end_src

Example queries for Wallhaven:
- Dark: =night city=, =space=, =cyberpunk=, =neon=, =noir=
- Light: =nature=, =sky=, =minimal=, =white art=
- Genres: =anime=, =landscape=, =abstract=, =digital art=

*** Unsplash

[[https://unsplash.com][Unsplash]] offers free high-quality photos.

1. Create an application: https://unsplash.com/developers
2. Copy your Access Key
3. Add to config:

#+begin_src toml
[providers.unsplash]
auth = "${UNSPLASH_ACCESS_KEY}"
#+end_src

*** Environment Variables

The =auth= field supports environment variables:

#+begin_src toml
# From environment variable
auth = "${WALLHAVEN_API_KEY}"

# With fallback value (if variable is not set)
auth = "${WALLHAVEN_API_KEY:-default_key}"

# Alternative syntax
auth = "$WALLHAVEN_API_KEY"

# Or directly (not recommended for version control)
auth = "actual_api_key"
#+end_src

** Examples

*** Setup with Wallhaven

#+begin_src bash
# 1. Export your API key
export WALLHAVEN_API_KEY="your_key_here"

# 2. Edit config
vim ~/.config/wallboy/config.toml

# Add:
# [providers.wallhaven]
# auth = "${WALLHAVEN_API_KEY}"
#
# [dark]
# dirs = ["~/Pictures/Wallpapers/Dark"]
# upload-dir = "~/Pictures/Wallpapers/Dark"
# queries = ["cyberpunk", "neon", "night city"]

# 3. Get a wallpaper
wallboy next

# 4. If you like it - save
wallboy save

# 5. If you don't - get next
wallboy next
#+end_src

*** Use Custom Query

#+begin_src bash
# Override configured queries with a custom one
wallboy next --query "epic anime landscape"

# Useful for one-off searches without changing config
wallboy next -q "minimalist gradient"
#+end_src

*** Force a Theme

#+begin_src bash
# Use dark theme regardless of system settings
wallboy next --theme dark

# Use light theme
wallboy next --theme light
#+end_src

*** Analyze Colors

#+begin_src bash
# Top 10 colors (default)
wallboy colors

# Top 5 colors
wallboy colors --top 5
#+end_src

** Auto-rotation

Wallboy can automatically change wallpapers at regular intervals using macOS launchctl.

*** Install Agent

#+begin_src bash
# Install with default interval (10 minutes)
wallboy agent-install

# Install with custom interval (30 minutes)
wallboy agent-install --interval=1800

# Minimum interval is 60 seconds
wallboy agent-install --interval=60
#+end_src

*** Check Status

#+begin_src bash
wallboy agent-status
# ✔ Agent is running
#   Interval: 10 minutes
#   Log: ~/.config/wallboy/agent.log
#+end_src

*** View Logs

#+begin_src bash
tail -f ~/.config/wallboy/agent.log
#+end_src

*** Uninstall Agent

#+begin_src bash
wallboy agent-uninstall
#+end_src
